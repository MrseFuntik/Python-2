# Python-FastAPI-Docker
Репозиторий представляет собой выполненное домашнее задание по курсу "Прикладной Python".
# Инструкция к Docker
Сначала клонируем репозиторий с Dockerfile
![](https://github.com/MrseFuntik/python_hw4/blob/main/Ex/Example-usage%20(check%20&%20help%20&%20last).gif)
```
git clone https://github.com/MrseFuntik/python_hw4
```

Затем переходим в директорию репозитория

```
cd python_hw4
```

Далее создаём Docker-образ с помощью команды:

```
docker build -t hw .
```

Образ будет создаваться достаточно долго из-за необходимости установки всех зависимостей torch, в результате получится около 9 Гб. После создания образа, необходимо запустить контейнер. Для этого нам нужно посмотреть id образа. Через Docker Desktop сделать это можно так:
![image](https://github.com/MrseFuntik/python_hw4/assets/136927535/f3993633-2eb3-4347-b15c-5b5ec2e95eaf)


Либо через командную строку:

```
docker images --no-trunc
```

Должно получится что-то вроде:
![image](https://github.com/MrseFuntik/python_hw4/assets/136927535/a2fa7ce2-389c-484b-bb8c-caff55f3f4e4)


Отсюда нам нужно скопировать id нашего образа. Далее запускаем контейнер на порту 8000:8000, как на примере ниже:
![image](https://github.com/MrseFuntik/python_hw4/assets/136927535/0cce9006-d2bf-4013-a72f-78dad4261da3)


После чего наш сервис заработает локально. Чтобы взаимодействовать с ним, достаточно открыть в браузере ссылку из командной строки:
![image](https://github.com/MrseFuntik/python_hw4/assets/136927535/966daae0-adeb-4b0a-974e-f45c11c4da6c)


Либо же можно протестировать сервис через Postman или подобные программы. В репозитории в папке Docker-Examples есть три записи со всеми необходимыми шагами для распаковски Docker-контейнера.

# Инструкция по взаимодействию с веб-сервисом

Веб-сервис доступен по ссылке https://python-hw4.onrender.com

Доступны также пять методов взаимодействия:

1) GET:  /check - проверка статуса работы сервиса
2) GET:  /help - справка о использовании
3) POST: /uploadfile - загрузить изображение и получить ответ (изображение с классификацией объектов)
4) GET: /last - получение информации о последнем загруженном изображении
5) POST: /mode - изменить режим работы модели

Поговорим подробнее про 3 и 5 методы. Чтобы загрузить изображение, можно использовать любое приложение для тестирования API. Разберём на примере Postman. Для этого нужно выбрать метод POST, Params : Body -> form-data, в качестве параметра указать "file", также тип параметра "File", после чего загрузить изображение. Пример показан на скриншоте ниже.

![image](https://github.com/MrseFuntik/python_hw4/assets/136927535/0f6ed78f-df30-42a9-82c8-8fc1f567451e)


_Примечание: не рекомендуется загружать изображения высокого разрешения, так как бесплатный хостинг может не выдержать и выключиться на некоторое время. Также, веб-сервису необходимо некоторое время, чтобы перезапуститься после сна, поэтому после отправки первого запроса подождите некоторое время (от 20 секунд до нескольких минут), после чего всё должно заработать._

Теперь про работу метода /mode. Этот метод определяет, какие изображения будет возвращать модель - обычные, или чёрно-белые. В данном случае метод POST поддерживает два параметра: "gray" и "default". В качестве параметра указывайте "mode", как на примере ниже.

![image](https://github.com/MrseFuntik/python_hw4/assets/136927535/9950f230-c9aa-4f30-9dff-64135dd000fd)


__На этом инструкция по использованию веб-сервиса заканчивается. Долгих дней и приятных ночей, сэй!__



